<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>Document</title>
</head>

<body>


    <div class="container">
        <div id="posts" class="row gy-4">


            
            <form class="col-md-12 pt-4 d-flex flex-column">

                <div class="accordion" id="accordionExample">
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingThree">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                          Make a post
                        </button>
                      </h2>
                      <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
                        <div class="accordion-body d-flex flex-column">
                            <input id="postTitle" type="text" class="mb-5" >
                            <textarea id="postDesc" cols="30" rows="10"></textarea>
                            <button id="post" class="btn btn-block btn-secondary btn-lg mt-3">Post</button>
                        </div>
                      </div>
                    </div>
                </div>


               
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

    <script>

        function postBody(postTitle, postDescription){
            const postBody = document.createElement('div');
            postBody.classList.add('col-md-3');

            const card = document.createElement('div');
            card.classList.add('card');
            card.setAttribute('style', 'width: 18rem;');

            postBody.appendChild(card);

            const cardBody = document.createElement('div');
            cardBody.classList.add('card-body');    
            card.appendChild(cardBody);

            const title = document.createElement('h5');
            title.classList.add('card-title');
            title.innerText = postTitle;
            cardBody.appendChild(title);

            const desc = document.createElement('p');
            desc.classList.add('card-text');
            cardBody.appendChild(desc);
            desc.innerText = postDescription
            document.querySelector('#posts').appendChild(postBody);
        }

        function XHRequest(verb, endpoint, data){
            const xhr = new XMLHttpRequest();
            xhr.responseType = 'json';
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200 && verb === 'get') {
                    xhr.response.map(el => {
                        postBody(el.title, el.description);
                    });
                }
            }
            xhr.open(verb, endpoint, true);


            if ( verb === 'get' ){
                xhr.send();
            } else if(verb === 'post') {
                xhr.setRequestHeader('Content-Type','application/json');
                xhr.send(JSON.stringify(data));
            }
            
        }
        
        document.getElementById('post').addEventListener('click', function(e){
            e.preventDefault();
            const blogTitle = document.querySelector('#postTitle').value;
            const blogDesc = document.querySelector('#postDesc').value;


            const data = {
                    "title": blogTitle,
                    "description": blogDesc
                };
            XHRequest('post', 'http://localhost:3000/posts', data);
            postBody(blogTitle, blogDesc);
            document.querySelector('#postTitle').value = '';
            document.querySelector('#postDesc').value = '';
        });



        function getPosts() {
            XHRequest('get', 'http://localhost:3000/posts');
        }

        window.onload = function(){
            getPosts();
        }


    </script>
</body>

</html>